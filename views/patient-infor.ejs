<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/style.css" />
  <title>Patient Information</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .appointment-tab {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      max-height: 400px;
      overflow-y: auto;
      z-index: 1050;
    }

    .appointment-tab .list-group-item {
      font-size: 14px;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Hospital Management</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="#">Patient List</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Staff List</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Appointment List</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4">
    <!-- Patient Information Section -->
    <div class="row justify-content-center mb-4">
      <div class="col-md-8 col-lg-6">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title text-center">Patient Information</h5>
            <div class="row">
              <div class="col-6">
                <p class="card-text">
                  <strong>Name:</strong>
                  <%= patient.first_name %>
                    <%= patient.last_name %>
                </p>
                <p class="card-text">
                  <strong>ID:</strong>
                  <%= patient.id %>
                </p>
                <p class="card-text">
                  <strong>Date of Birth:</strong>
                  <span class="formatted-date" data-dob="<%= patient.date_of_birth %>"></span>
                </p>
              </div>
              <div class="col-6">
                <p class="card-text">
                  <strong>Phone:</strong>
                  <%= patient.phone %>
                </p>
                <p class="card-text">
                  <strong>Address:</strong>
                  <%= patient.address %>
                </p>
                <p class="card-text">
                  <strong>Allergies:</strong>
                  <%= allergy.allergy_name %>
                </p>
              </div>
            </div>
            <div class="d-flex justify-content-center mt-3">
              <!-- Button trigger modal for editing information -->
              <button type="button" class="btn btn-primary me-2" data-bs-toggle="modal"
                data-bs-target="#editPatientModal">
                Edit Information
              </button>
              <!-- Button trigger modal for creating appointment -->
              <button type="button" class="btn btn-success" data-bs-toggle="modal"
                data-bs-target="#createAppointmentModal">
                Create Appointment
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Appointment History Section -->
    <div class="row justify-content-center">
      <div class="col-md-10 col-lg-8">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Appointment History</h5>
            <div class="list-group">
              <% appointment_notes.forEach(function(note){ %>
                <div href="#" class="list-group-item list-group-item-action mb-3">
                  <strong>Date:</strong>
                  <span class="formatted-date" data-dob="<%= note.date_of_appointment %>"></span><br />
                  <strong>Observation:</strong>
                  <%= note.observation %><br />
                    <strong>Doctor's Note:</strong>
                    <%= note.doctor_note %><br />
                </div>
                <% }) %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Appointment Tab -->
  <div class="card appointment-tab">
    <div class="card-body">
      <h5 class="card-title">Upcoming Appointments</h5>
      <div class="list-group">
        <a href="#" class="list-group-item list-group-item-action mb-3">
          <strong>Date:</strong> 2023-12-10<br />
          <strong>Doctor:</strong> Dr. John Smith<br />
          <strong>Department:</strong> General Medicine<br />
          <strong>Status:</strong> Upcoming
        </a>
        <a href="#" class="list-group-item list-group-item-action mb-3">
          <strong>Date:</strong> 2024-01-15<br />
          <strong>Doctor:</strong> Dr. Emily Davis<br />
          <strong>Department:</strong> Cardiology<br />
          <strong>Status:</strong> Upcoming
        </a>
      </div>
    </div>
  </div>

  <!-- Modal for Editing Patient Information -->
  <div class="modal fade" id="editPatientModal" tabindex="-1" aria-labelledby="editPatientModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editPatientModalLabel">Edit Patient Information</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="/patients/update/<%= patient.id %>" method="post">
            <div class="mb-3">
              <label for="patientFirstName" class="form-label">First Name</label>
              <input type="text" name="first_name" class="form-control" id="patientFirstName" value="<%= patient.first_name %>" />
            </div>
            <div class="mb-3">
              <label for="patientLastName" class="form-label">Last Name</label>
              <input type="text" name="last_name" class="form-control" id="patientLastName" value="<%= patient.last_name %>" />
            </div>
            <div class="mb-3">
              <label for="patientID" class="form-label">Patient ID</label>
              <input type="text" name="id" class="form-control" id="patientID" value="<%= patient.id %>" />
            </div>
            <div class="mb-3">
              <label for="patientDOB" class="form-label">Date of Birth</label>
              <input type="date" name="date_of_birth" class="form-control" id="patientDOB" value="<%= patient.date_of_birth %>" />
            </div>
            <div class="mb-3">
              <label for="patientAdress" class="form-label">Adress Details</label>
              <input type="text" name="address" class="form-control" id="patientAdress" value="<%= patient.address %>" />
            </div>
            <div class="mb-3">
              <label for="patientPhone" class="form-label">Phone Details</label>
              <input type="text" name="phone" class="form-control" id="patientPhone" value="<%= patient.phone %>" />
            </div>
            <div class="mb-3">
              <label for="patientAllergies" class="form-label">Allergies</label>
              <input type="text" name="allergy" class="form-control" id="patientAllergies" value="<%= allergy.allergy_name %>" />
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal for Creating Appointment -->
  <div class="modal fade" id="createAppointmentModal" tabindex="-1" aria-labelledby="createAppointmentModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="createAppointmentModalLabel">Create Appointment</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="appointmentDate" class="form-label">Date of Appointment</label>
              <input type="date" class="form-control" id="appointmentDate" />
            </div>
            <div class="mb-3">
              <label for="appointmentDepartment" class="form-label">Department</label>
              <select class="form-select" id="appointmentDepartment" onchange="updateDoctors()">
                <option selected disabled>Select Department</option>
                <option value="General Medicine">General Medicine</option>
                <option value="Cardiology">Cardiology</option>
                <option value="Orthopedics">Orthopedics</option>
                <option value="Dermatology">Dermatology</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="appointmentDoctor" class="form-label">Doctor</label>
              <select class="form-select" id="appointmentDoctor" disabled>
                <option selected disabled>Select Doctor</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="appointmentObservation" class="form-label">Observation</label>
              <textarea class="form-control" id="appointmentObservation" rows="3"></textarea>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-success">Create Appointment</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript to dynamically update doctors based on department selection -->
  <script>
    function updateDoctors() {
      const department = document.getElementById(
        "appointmentDepartment"
      ).value;
      const doctorSelect = document.getElementById("appointmentDoctor");
      doctorSelect.innerHTML = ""; // Clear existing options

      let doctors = [];
      switch (department) {
        case "General Medicine":
          doctors = ["Dr. John Smith", "Dr. Amanda Brown"];
          break;
        case "Cardiology":
          doctors = ["Dr. Emily Davis", "Dr. Robert Williams"];
          break;
        case "Orthopedics":
          doctors = ["Dr. Michael Lee", "Dr. Sarah Johnson"];
          break;
        case "Dermatology":
          doctors = ["Dr. Alice White", "Dr. David Green"];
          break;
      }

      doctors.forEach((doctor) => {
        const option = document.createElement("option");
        option.value = doctor;
        option.text = doctor;
        doctorSelect.appendChild(option);
      });

      doctorSelect.disabled = false; // Enable doctor selection
    }

    // Date formatting function for YYYY/MM/DD format
    function formatDate(dateString) {
      const date = new Date(dateString);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}/${month}/${day}`;
    }

    // Format all dates on page load
    document.addEventListener('DOMContentLoaded', function () {
      const dateElements = document.querySelectorAll('.formatted-date');
      dateElements.forEach(el => {
        const date = el.getAttribute('data-dob');
        el.textContent = formatDate(date);
      });
    });

  </script>
</body>

</html>